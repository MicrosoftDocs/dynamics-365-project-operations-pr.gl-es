---
title: Configurar creación automática de facturas
description: Este tema ofrece información sobre como configurar a creación automática de facturas proforma.
author: rumant
manager: Annbe
ms.date: 04/05/2021
ms.topic: article
ms.service: project-operations
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 359c5902e0b6a08ab7fc982095062e4d1816db6c
ms.sourcegitcommit: ca0fc078d1a12484eca193fe051b8442c0559db8
ms.translationtype: HT
ms.contentlocale: gl-ES
ms.lasthandoff: 04/07/2021
ms.locfileid: "5866815"
---
# <a name="set-up-automatic-invoice-creation"></a><span data-ttu-id="9c1b8-103">Configurar creación automática de facturas</span><span class="sxs-lookup"><span data-stu-id="9c1b8-103">Set up automatic invoice creation</span></span> 
 
<span data-ttu-id="9c1b8-104">_**Aplícase a:** Despregamento Lite - factura proforma, Project Operations para situacións baseadas en recursos/sen fornecemento_</span><span class="sxs-lookup"><span data-stu-id="9c1b8-104">_**Applies To:** Lite deployment - deal to proforma invoicing, Project Operations for resource/non-stocked based scenarios_</span></span>

<span data-ttu-id="9c1b8-105">Pode configurar creación automática de facturas en Dynamics 365 Project Operations.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="9c1b8-106">O sistema crea un borrador de factura proforma baseado na programación de facturas de cada contrato de proxecto e liña de contrato.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="9c1b8-107">As programacións de facturas configúranse a nivel de liña de contrato.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="9c1b8-108">Cada liña dun contrato pode ter unha programación de facturas distinta ou pode incluírse a mesma programación de facturas en cada liña do contrato.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="9c1b8-109">Cando crea unha factura, o sistema sempre crea polo menos unha factura por contrato de proxecto.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="9c1b8-110">Nalgúns casos, pode haber varias facturas creadas.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-110">In some cases, there may be multiple invoices created.</span></span> <span data-ttu-id="9c1b8-111">Por exemplo, se o contrato ten varios clientes, crearase o mesmo número de facturas que o número de clientes que teñen que facturar transaccións facturables nese contrato do proxecto.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="9c1b8-112">Comprender como se inclúen as transaccións nunha factura</span><span class="sxs-lookup"><span data-stu-id="9c1b8-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="9c1b8-113">Ás veces, cada liña de contrato baseada en proxectos especifica unha programación de facturas independente.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="9c1b8-114">Por exemplo, os servizos de implementación do contrato de Adatum teñen as seguintes liñas de contrato:</span><span class="sxs-lookup"><span data-stu-id="9c1b8-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="9c1b8-115">Traballo de prototipo que é un prezo fixo con dous fitos creados manualmente.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="9c1b8-116">Traballo de implementación que inclúe o tempo e que se facturará cada dous semanas os luns.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="9c1b8-117">Gastos incorridos que deben ser facturados mensualmente o primeiro luns de cada mes.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="9c1b8-118">As programacións de facturas definidas en cada unha destas dúas partidas parécense á seguinte táboa:</span><span class="sxs-lookup"><span data-stu-id="9c1b8-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="9c1b8-119">Liña de contrato</span><span class="sxs-lookup"><span data-stu-id="9c1b8-119">Contract line</span></span> | <span data-ttu-id="9c1b8-120">Data de execución da factura</span><span class="sxs-lookup"><span data-stu-id="9c1b8-120">Invoice run date</span></span> | <span data-ttu-id="9c1b8-121">Data límite da transacción</span><span class="sxs-lookup"><span data-stu-id="9c1b8-121">Transaction cut-off date</span></span> | <span data-ttu-id="9c1b8-122">Data do fito</span><span class="sxs-lookup"><span data-stu-id="9c1b8-122">Milestone date</span></span> | <span data-ttu-id="9c1b8-123">Cantidade do fito</span><span class="sxs-lookup"><span data-stu-id="9c1b8-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="9c1b8-124">Traballo de prototipo</span><span class="sxs-lookup"><span data-stu-id="9c1b8-124">Prototype work</span></span> | <span data-ttu-id="9c1b8-125">Luns 5 de outubro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-125">October 5, Monday</span></span> | - | <span data-ttu-id="9c1b8-126">Luns 5 de outubro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-126">October 5, Monday</span></span> | <span data-ttu-id="9c1b8-127">5000 USD</span><span class="sxs-lookup"><span data-stu-id="9c1b8-127">5000 USD</span></span> |
| - | <span data-ttu-id="9c1b8-128">Martes 3 de decembro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="9c1b8-129">Martes 3 de decembro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-129">November 3, Tuesday</span></span> | <span data-ttu-id="9c1b8-130">12,000 USD</span><span class="sxs-lookup"><span data-stu-id="9c1b8-130">12,000 USD</span></span> |
| <span data-ttu-id="9c1b8-131">Traballo de implementación</span><span class="sxs-lookup"><span data-stu-id="9c1b8-131">Implementation work</span></span> | <span data-ttu-id="9c1b8-132">Luns 5 de outubro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-132">October 5, Monday</span></span> | <span data-ttu-id="9c1b8-133">Domingo 4 de outubro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="9c1b8-134">Luns 19 de outubro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-134">October 19, Monday</span></span> | <span data-ttu-id="9c1b8-135">Domingo 18 de outubro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="9c1b8-136">Luns 2 de novembro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-136">November 2, Monday</span></span> | <span data-ttu-id="9c1b8-137">Domingo 1 de novembro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="9c1b8-138">Luns 16 de novembro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-138">November 16, Monday</span></span> | <span data-ttu-id="9c1b8-139">Domingo 15 de novembro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="9c1b8-140">Gastos incorridos</span><span class="sxs-lookup"><span data-stu-id="9c1b8-140">Expenses incurred</span></span> | <span data-ttu-id="9c1b8-141">Luns 5 de outubro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-141">October 5, Monday</span></span> | <span data-ttu-id="9c1b8-142">Domingo 4 de outubro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="9c1b8-143">Luns 2 de novembro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-143">November 2, Monday</span></span> | <span data-ttu-id="9c1b8-144">Domingo 1 de novembro</span><span class="sxs-lookup"><span data-stu-id="9c1b8-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="9c1b8-145">Neste exemplo cando se executa a facturación automática:</span><span class="sxs-lookup"><span data-stu-id="9c1b8-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="9c1b8-146">**4 de outubro ou calquera data anterior**: Non se xera ningunha factura por este contrato porque a táboa **Programación de facturas** para cada unha destas liñas de contrato non indica o domingo 4 de outubro como data de execución da factura.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-146">**October 4 or any date before**: No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="9c1b8-147">**Luns 5 de outubro**: Xérase unha factura por:</span><span class="sxs-lookup"><span data-stu-id="9c1b8-147">**October 5 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="9c1b8-148">Traballo de prototipo que inclúe o fito, se está marcado como **Listo para facturar**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="9c1b8-149">Traballo de implementación que inclúe todas as transaccións de tempo creadas antes da data de corte da transacción de domingo 4 de outubro, que está marcada como **Lista para facturar**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="9c1b8-150">Gasto incorrido que inclúe todas as transaccións de gasto creadas antes da data de corte da transacción de domingo 4 de outubro, que está marcada como **Lista para facturar**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="9c1b8-151">**O 6 de outubro ou calquera data anterior ao 19 de outubro**: Non se xera ningunha factura por este contrato porque a táboa **Programación de facturas** para cada unha destas liñas de contrato non indica o 6 de outubro ou calquera data anterior ao 19 de outubro como data de execución da factura.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-151">**On October 6 or any date before October 19**: No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="9c1b8-152">**Domingo 19 de outubro**: Xérase unha factira por traballo de implementación que inclúe todas as transaccións de tempo creadas antes da data de corte da transacción de domingo 1 de outubro, que está marcada como **Lista para facturar**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-152">**October 19, Monday**: One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="9c1b8-153">**Luns 2 de novembro**: Xérase unha factura por:</span><span class="sxs-lookup"><span data-stu-id="9c1b8-153">**November 2 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="9c1b8-154">Traballo de implementación que inclúe todas as transaccións de tempo creadas antes da data de corte da transacción de domingo 1 de novembro, que está marcada como **Lista para facturar**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="9c1b8-155">Gasto incorrido que inclúe todas as transaccións de gasto creadas antes da data de corte da transacción de domingo 1 de novembro, que está marcada como **Lista para facturar**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="9c1b8-156">**Martes 3 de novembro**: Xérase unha factura para o traballo de prototipo xerado que inclúe o fito para 12000 USD, se está marcado como **Listo para facturar**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-156">**November 3, Tuesday**: One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="9c1b8-157">Configurar facturación automática</span><span class="sxs-lookup"><span data-stu-id="9c1b8-157">Configure automatic invoicing</span></span>

<span data-ttu-id="9c1b8-158">Complete os pasos seguintes para configurar unha factura automatizada executada.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="9c1b8-159">En **Project Operations**, vaia a **Configuración** > **Configuración de facturas periódicas**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-159">In **Project Operations**, go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="9c1b8-160">Cree un traballo en lote e noméelo **Crear facturas de Project Operations**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="9c1b8-161">O nome do traballo en lote debe incluír as palabras "crear facturas".</span><span class="sxs-lookup"><span data-stu-id="9c1b8-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="9c1b8-162">No campo **Tipo de traballo**, seleccione **Ningún**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="9c1b8-163">Por defecto, os campos **Frecuencia diaria** e **Está activo** están definidas en **Si**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="9c1b8-164">Seleccione **Executar fluxo de traballo**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-164">Select **Run Workflow**.</span></span> <span data-ttu-id="9c1b8-165">Na caixa de diálogo **Buscar rexistro**, verá tres fluxos de traballo:</span><span class="sxs-lookup"><span data-stu-id="9c1b8-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="9c1b8-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="9c1b8-166">ProcessRunCaller</span></span>
- <span data-ttu-id="9c1b8-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="9c1b8-167">ProcessRunner</span></span>
- <span data-ttu-id="9c1b8-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="9c1b8-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="9c1b8-169">Seleccione **ProcessRunCaller** e, a seguir, seleccione **Engadir**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-169">Select **ProcessRunCaller**, and then select **Add**.</span></span>
6. <span data-ttu-id="9c1b8-170">Na caixa de diálogo seguinte, seleccione **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="9c1b8-171">Un fluxo de traballo **Suspensión** vai seguido por fluxo de traballo **Proceso**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="9c1b8-172">Tamén pode seleccionar **ProcessRunner** no paso 5.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="9c1b8-173">Entón, cando seleccione **Aceptar**, o fluxo de traballo **Proceso** vai seguido por un fluxo de traballo **Suspensión**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-173">Then, when you select **OK**, a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="9c1b8-174">Os fluxos de traballo **ProcessRunCaller** e **ProcessRunner** crean facturas.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="9c1b8-175">**ProcessRunCaller** chama a **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="9c1b8-176">**ProcessRunner** é o fluxo de traballo que realmente crea as facturas.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="9c1b8-177">O fluxo de traballo percorre todas as liñas de contrato nas que deben crearse as facturas e crea facturas para esas liñas.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="9c1b8-178">Para determinar as liñas de contrato para as que deben crearse as facturas, o traballo analiza as datas de execución de facturas para as liñas de contrato.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="9c1b8-179">Se as liñas de contrato que pertencen a un contrato teñen a mesma data de execución de facturas, as transaccións combínanse nunha factura que ten dúas liñas de factura.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="9c1b8-180">Se non hai transaccións para as que crear facturas, o traballo omite a creación dunha factura.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="9c1b8-181">Despois de que **ProcessRunner** remate a execución, chama a **ProcessRunCaller**, fornece a hora de finalización e péchase.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller**, provides the end time, and is closed.</span></span> <span data-ttu-id="9c1b8-182">A seguir, **ProcessRunCaller** inicia un temporizador que se executa durante 24 horas desde a hora de finalización especificada.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="9c1b8-183">Ao final do temporizador, **ProcessRunCaller** péchase.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="9c1b8-184">O traballo de proceso por lotes para crear facturas é un traballo recorrente.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="9c1b8-185">Se este proceso de lotes se executa moitas veces, créanse varias instancias do traballo e causa erros.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="9c1b8-186">Polo tanto, debe iniciar o proceso por lotes unha soa vez e logo reinícieo só se deixa de executarse.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="9c1b8-187">A facturación por lotes en Project Operations só se executa para as liñas de contrato do proxecto que están configuradas por programacións de facturas.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="9c1b8-188">Unha liña de contrato cun método de facturación de prezos fixos debe ter configurados os fitos.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="9c1b8-189">Unha liña de contrato de proxecto cun método de facturación de tempo e material necesitará unha programación de facturas baseado na data configurada.</span><span class="sxs-lookup"><span data-stu-id="9c1b8-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
